import streamlit as st
import random
from PIL import Image

st.set_page_config(page_title="ìœ ë¦¬ì‹ ë¬¸ì œì§‘", page_icon="ğŸ“˜", layout="centered")

# ì´ë¯¸ì§€ ê²½ë¡œ (images í´ë” ì•„ë˜ì— IMG_0019.png ë¥¼ ë„£ì–´ì£¼ì„¸ìš”)
GANADI_PATH = "images/IMG_0019.png"

st.title("ğŸ“— ìœ ë¦¬ì‹ ë¬¸ì œì§‘ (ê³ 1 ìˆ˜ì¤€)")
st.write("ìœ ë¦¬ì‹ì˜ ì„±ì§ˆ Â· ì—°ì‚° Â· ìœ ë¦¬í•¨ìˆ˜ ì„±ì§ˆ ë¬¸ì œ ì´ 15ë¬¸ì œ â€” ê°ê´€ì‹ ë³´ê¸° 5ê°œ")

# -----------------------
# ìœ ë¦¬ì‹ ì—°ì‚° ë¬¸ì œ ìƒì„±: ê²°ê³¼ê°€ ì •ìˆ˜(1~100)ë¡œ ë–¨ì–´ì§€ë„ë¡ ë°˜ë³µ ìƒì„±
# -----------------------
def generate_rational_operation():
    # ìˆ«ì ë²”ìœ„ê³¼ ì‹œë„ ì œí•œì„ ë‘ì–´ ë¬´í•œë£¨í”„ ë°©ì§€
    for _ in range(500):
        a = random.randint(1, 12)
        b = random.randint(1, 12)
        c = random.randint(1, 12)
        d = random.randint(1, 12)
        op = random.choice(["+", "-", "*", "/"])

        if op == "+":
            expr = f"({a}/{b}) + ({c}/{d})"
            num = a * d + b * c
            den = b * d
        elif op == "-":
            expr = f"({a}/{b}) - ({c}/{d})"
            num = a * d - b * c
            den = b * d
        elif op == "*":
            expr = f"({a}/{b}) Ã— ({c}/{d})"
            num = a * c
            den = b * d
        else:  # ë‚˜ëˆ—ì…ˆ
            # ë‚˜ëˆ—ì…ˆ: (a/b) Ã· (c/d) = (a*d) / (b*c)
            expr = f"({a}/{b}) Ã· ({c}/{d})"
            num = a * d
            den = b * c

        if den == 0:
            continue
        if num % den != 0:
            continue
        value = num // den
        if 1 <= value <= 100:
            return expr, str(value)
    # ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ì•ˆì „ ë¬¸ì œ ë°˜í™˜ (ê±°ì˜ ë°œìƒí•˜ì§€ ì•ŠìŒ)
    return "(1/1) + (1/1)", "2"

# -----------------------
# ê°ê´€ì‹ ë¬¸ì œ ë¦¬ìŠ¤íŠ¸(ê°œë… ë¬¸ì œë“¤) â€” ê³ 1 ê³µí†µìˆ˜í•™ ìˆ˜ì¤€
# -----------------------
concept_problems = [
    ("ìœ ë¦¬ì‹ì˜ ì •ì˜ë¡œ ê°€ì¥ ì•Œë§ì€ ê²ƒì€?", "ë‘ ë‹¤í•­ì‹ì˜ ë‚˜ëˆ—ì…ˆ ê¼´",
     ["ë‘ ë‹¤í•­ì‹ì˜ ë‚˜ëˆ—ì…ˆ ê¼´", "í•­ìƒ ì •ìˆ˜ë§Œìœ¼ë¡œ ì´ë£¨ì–´ì§„ ì‹", "ë¶„ëª¨ê°€ ì—†ëŠ” ì‹", "ìƒìˆ˜ í•¨ìˆ˜ë§Œ í•´ë‹¹", "í•­ìƒ 1ì°¨ì‹"]),
    ("ìœ ë¦¬í•¨ìˆ˜ f(x)=1/xì˜ ì •ì˜ì—­ì—ì„œ ì œì™¸ë˜ëŠ” ê°’ì€?", "x=0",
     ["x=1", "x=0", "ëª¨ë“  ì‹¤ìˆ˜", "x=-1", "ì •ì˜ì—­ì— ì œì™¸ë˜ëŠ” ê°’ì´ ì—†ë‹¤"]),
    ("ìœ ë¦¬ì‹ì˜ ê³±ì…ˆì„ í•  ë•Œ ì˜¬ë°”ë¥¸ ê·œì¹™ì€?", "ë¶„ìë¼ë¦¬ ê³±í•˜ê³  ë¶„ëª¨ë¼ë¦¬ ê³±í•œë‹¤",
     ["ë¶„ìë¼ë¦¬ ê³±í•˜ê³  ë¶„ëª¨ë¼ë¦¬ ê³±í•œë‹¤", "ë¶„ìë¥¼ í†µë¶„í•œë‹¤", "í•­ìƒ í†µë¶„ í›„ ë”í•œë‹¤", "ë¶„ëª¨ë¼ë¦¬ ë”í•œë‹¤", "ë¶„ëª¨ë¥¼ ì—†ì•¤ë‹¤"]),
    ("ìœ ë¦¬í•¨ìˆ˜ì˜ ìˆ˜ì§ì ê·¼ì„ ì´ ìƒê¸°ëŠ” ì´ìœ ëŠ”?", "ë¶„ëª¨ê°€ 0ì´ ë˜ëŠ” x ê°’ ë•Œë¬¸",
     ["ë¶„ìê°€ 0ì´ ë˜ëŠ” x ê°’ ë•Œë¬¸", "í•¨ìˆ˜ê°’ì´ ë¬´í•œëŒ€ì¼ ë•Œ", "í•­ìƒ y=0 ë•Œë¬¸", "ê·¸ë˜í”„ê°€ êµì°¨í•  ë•Œ", "ë¶„ëª¨ê°€ 1ì¼ ë•Œ"]),
    ("ìˆ˜í‰ì ê·¼ì„ ì˜ ì˜ë¯¸ë¡œ ì˜³ì€ ê²ƒì€?", "x â†’ Â±âˆ ì¼ ë•Œ yê°€ ê°€ê¹Œì›Œì§€ëŠ” ì§ì„ ",
     ["x â†’ Â±âˆ ì¼ ë•Œ yê°€ ê°€ê¹Œì›Œì§€ëŠ” ì§ì„ ", "í•­ìƒ y=0ì¸ ì§ì„ ", "ê·¸ë˜í”„ê°€ ë°˜ë“œì‹œ ì§€ë‚˜ëŠ” ì§ì„ ", "ìˆ˜ì§ì„  í˜•íƒœ", "ì¡´ì¬í•  ìˆ˜ ì—†ë‹¤"]),
    ("ìœ ë¦¬ì‹ì˜ ë§ì…ˆì—ì„œ í†µë¶„ì„ í•˜ëŠ” ì´ìœ ëŠ”?", "ë¶„ëª¨ë¥¼ ë™ì¼í•˜ê²Œ ë§Œë“¤ì–´ ë”í•˜ê¸° ìœ„í•´",
     ["ë¶„ëª¨ë¥¼ ë™ì¼í•˜ê²Œ ë§Œë“¤ì–´ ë”í•˜ê¸° ìœ„í•´", "ë¶„ìë¥¼ 0ìœ¼ë¡œ ë§Œë“¤ê¸° ìœ„í•´", "í•­ìƒ ì•½ë¶„í•˜ê¸° ìœ„í•´", "ê³±ì…ˆì„ ì‰½ê²Œ í•˜ê¸° ìœ„í•´", "í•¨ìˆ˜ì˜ ê°’ì„ ë°”ê¾¸ê¸° ìœ„í•´"]),
    ("ë‹¤ìŒ ì¤‘ ìœ ë¦¬í•¨ìˆ˜ê°€ ì•„ë‹Œ ê²ƒì€?", "f(x)=3x+2",
     ["f(x)=1/x", "f(x)=(x+1)/(x-2)", "f(x)=3x+2", "f(x)=(x^2+1)/(x+3)", "f(x)=(2x-1)/(x^2+1)"]),
    ("ìœ ë¦¬í•¨ìˆ˜ ê·¸ë˜í”„ì˜ ì¼ë°˜ì  ëª¨ì–‘ì€?", "ìŒê³¡ì„ ",
     ["ìŒê³¡ì„ ", "ì§ì„ ", "í¬ë¬¼ì„ ", "ì›", "ê³¡ì„  ì—†ìŒ"]),
]

# -----------------------
# ë¬¸ì œ ì¡°í•© ë§Œë“¤ê¸°: ê°œë… ë¬¸ì œ + ì—°ì‚° ë¬¸ì œ(6ê°œ) => ì´ 15ë¬¸ì œ
# -----------------------
problems = []
# ë¨¼ì € ê°œë… ë¬¸ì œë“¤(ê°ê´€ì‹)
for q, ans, opts in concept_problems:
    # ë³´ê¸°ê°€ 5ê°œê°€ ë˜ë„ë¡ í•„ìš”ì‹œ ë³´ì¶© (ì´ë¯¸ 5ê°œë¡œ êµ¬ì„±ë˜ì–´ ìˆìŒ)
    problems.append((q, ans, opts.copy()))

# ì—°ì‚° ë¬¸ì œ 6ê°œ ìë™ ìƒì„± (ë‹µì€ 1~100 ì •ìˆ˜ ë¬¸ìì—´)
for _ in range(6):
    expr, correct = generate_rational_operation()
    # ì •ë‹µì„ í¬í•¨í•´ ë³´ê¸° 5ê°œ ìƒì„± (ì •ë‹µ í¬í•¨)
    wrongs = set()
    while len(wrongs) < 4:
        w = str(random.randint(1, 100))
        if w != correct:
            wrongs.add(w)
    options = list(wrongs) + [correct]
    random.shuffle(options)
    problems.append((f"ë‹¤ìŒì„ ê³„ì‚°í•˜ì‹œì˜¤: {expr}", correct, options))

# ê°œìˆ˜ ë§ì¶”ê¸°: í˜„ì¬ ê°œë…_problems ê°¯ìˆ˜(8) + 6 ì—°ì‚° = 14 -> ì¶”ê°€ë¡œ í•œ ë¬¸ì œë¥¼ ë” ë§Œë“¤ì–´ ê³ ì •í˜• ê°œë…ë¬¸ì œ ì¶”ê°€
# (ì›í•˜ë©´ ë” ì¡°ì • ê°€ëŠ¥)
problems.append(("ìœ ë¦¬í•¨ìˆ˜ì—ì„œ ë¶„ëª¨ê°€ 0ì´ë©´ ì–´ë–¤ ì¼ì´ ì¼ì–´ë‚˜ë‚˜ìš”?", "ì •ì˜ë˜ì§€ ì•ŠëŠ”ë‹¤",
                 ["ì •ì˜ëœë‹¤", "ë¬´í•œíˆ ì»¤ì§„ë‹¤", "ì •ì˜ë˜ì§€ ì•ŠëŠ”ë‹¤", "í•­ìƒ 0ì´ ëœë‹¤", "í•¨ìˆ˜ê°’ì´ 1ì´ ëœë‹¤"]))

# í™•ì¸: ë¬¸ì œ ìˆ˜ê°€ 15ì¸ì§€
assert len(problems) == 15, f"ë¬¸ì œ ê°œìˆ˜ ì˜¤ë¥˜: {len(problems)} (ê¸°ëŒ€ê°’ 15)"

# -----------------------
# ë¬¸ì œ ì¶œë ¥ ë° ì±„ì 
# -----------------------
st.markdown("## ğŸ§® ë¬¸ì œ í’€ì´ (ì´ 15ë¬¸ì œ)")
score = 0

# ë¡œë“œ ê°€ëŠ¥í•œì§€ ë¯¸ë¦¬ ì²´í¬ (ì´ë¯¸ì§€ íŒŒì¼)
ganadi_img = None
try:
    ganadi_img = Image.open(GANADI_PATH)
except Exception:
    ganadi_img = None
    # íŒŒì¼ì´ ì—†ìœ¼ë©´ ì•ˆë‚´ ë©”ì‹œì§€ëŠ” ë‚˜ì¤‘ì— í‹€ë ¸ì„ ë•Œ ë³´ì—¬ì¤„ ê²ƒ

for i, (q, answer, opts) in enumerate(problems, start=1):
    st.write(f"### {i}. {q}")
    # ë¼ë””ì˜¤ ë²„íŠ¼ì˜ keyë¥¼ ë¬¸ì œ ë²ˆí˜¸ë¡œ ê³ ìœ í•˜ê²Œ ì§€ì •
    choice = st.radio(f"ë¬¸ì œ {i} ë‹µ ì„ íƒ:", opts, key=f"q{i}")

    # ì‚¬ìš©ìê°€ ì„ íƒí•˜ë©´ ë°”ë¡œ í”¼ë“œë°± (ì‹¤ì „ í…ŒìŠ¤íŠ¸ í˜•íƒœ)
    if choice:
        if choice == answer:
            st.success("ì •ë‹µì´ì•¼! ğŸ‰")
            score += 1
        else:
            st.error("ì‘ ì•„ë‹ˆì•¼ ğŸ˜…")
            if ganadi_img:
                st.image(ganadi_img, caption="ê°€ë‚˜ë””: ì‘ ì•„ë‹ˆì•¼!", use_column_width=False)
            else:
                st.warning(f"ì˜¤ë‹µì¼ ë•Œ í‘œì‹œí•  ì´ë¯¸ì§€({GANADI_PATH})ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. "
                           "images/IMG_0019.png íŒŒì¼ì„ í”„ë¡œì íŠ¸ì˜ images í´ë”ì— ë„£ì–´ì£¼ì„¸ìš”.")

st.markdown("---")
st.write(f"### âœ… ì´ {len(problems)}ë¬¸ì œ ì¤‘ ì •ë‹µ: {score}ë¬¸ì œ")

# ê°„ë‹¨í•œ í”¼ë“œë°± ë©”ì‹œì§€
if score == len(problems):
    st.balloons()
    st.success("ì™„ë²½í•´ìš”! ìœ ë¦¬ì‹ ë‹¬ì¸ì…ë‹ˆë‹¤ ğŸŒŸ")
elif score >= 10:
    st.info("ì˜í–ˆì–´ìš”! ì¡°ê¸ˆë§Œ ë” ì—°ìŠµí•´ìš” ğŸ’ª")
else:
    st.warning("ë³µìŠµì´ í•„ìš”í•´ìš”. ë‹¤ì‹œ í•œë²ˆ í’€ì–´ë³¼ê¹Œìš”? ğŸ“˜")
